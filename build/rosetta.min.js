!function(a){function b(a){this.name=a,this.components={},this.cacheComponents={},this.externalApps=[],this.imports={},this.rootContext={},this.onInit=[],this.onLoad=[],this.controllers={},this.cacheControllers={},this.tags={},this.tagsRepository=0}a.extend({modules:{},cacheModules:{},extension:{rosetta:{}},rosettaApp:null}),a.fn.injectDep=function(c,d,e,f){var g=[];if(d){var h={};for(var i in d)if(a.modules[d[i]]){var j;j=f&&f[d[i]]?f[d[i]]:a.module(d[i]),g.push(j),j instanceof b&&(h[d[i]]=j)}else if(e&&e.imports[d[i]]){var k=e.imports[d[i]],j=h[k];j||(j=a.module(k)),g.push(j.component(d[i]))}}g.unshift(c);var l=c.apply(c,g);return"undefined"==typeof l?c:l},a.fn.module=function(b,c,d,e,f){return d&&(a.modules[b]=function(){return a.injectDep(d,c,null,f)}),e&&(a.cacheModules[b]=a.modules[b]()),a.cacheModules[b]?a.cacheModules[b]:a.modules[b]()},a.fn.getRosettaApp=function(){if(a.cacheModules[a.rosettaApp])return a.cacheModules[a.rosettaApp]},a.module("rootContext",null,function(b){var c=a.getRosettaApp();if(c)return c.rootContext}),a.module("DOMParser",null,function(a){a.parser=new DOMParser,a.parseHTML=function(b){return a.parser.parseFromString(b,"text/html")}},!0),a.fn.rosetta=function(c,d){var e=new b(c),f={};for(var g in d)if(a.modules[d[g]]){var h=a.module(d[g]);if(f[d[g]]=h,e&&h instanceof b){e.externalApps.push(d[g]);for(var i in h.components)e.imports[i]=d[g]}}return a.module(c,d,function(){return e},!0,f)},b.prototype.init=function(b,c){var d=function(){c&&a.injectDep(c,b)};this.onInit.push(d)},b.prototype.load=function(b,c){var d=function(){c&&a.injectDep(c,b)};this.onLoad.push(d)},b.prototype.component=function(b,c,d,e,f){var g=this;return d&&(g.components[b]=function(){return a.injectDep(d,c,g,f)}),e&&(g.cacheComponents[b]=g.components[b]()),g.cacheComponents[b]?g.cacheComponents[b]:g.components[b]()};var c=function(b,c){a.bind(c.model,b)},d=function(a,b,c){c.model["_"+a].subscribe(function(a){b(a)})};b.prototype.controller=function(b,d,e,f){var g=this;e&&(g.controllers[b]=function(h){return e.model={},e.parent=h,e.watchers=[],e.binding=function(){c(b,e)},e.watch=function(a,b){e.watchers.push({prop:a,callback:b})},a.injectDep(e,d,g,f)})},b.prototype.tag=function(b,c,d){var e=this;if(d){var f=a.module("DOMParser");e.tags[b]=function(){var g=Object.create(HTMLElement.prototype);g.tag=d,g.behavior=function(a,b){return this.behaviors[this.state()][a]?this.behaviors[this.state()][a].apply(this,b):this.behaviors.shared&&this.behaviors.shared[a]?this.behaviors.shared[a].apply(this,b):void 0},g.state=function(a){if(a)this.binding||(this.binding={}),this.binding.state=a;else if(this.binding)return this.binding.state},g.model=function(){var b=this;if(a.subModelViews&&a.subModelViews[b.rosettaID]){var c=a.subModelViews[b.rosettaID].getSimpleModel();b.data=c.data,b.states=c.states}else{var d=b.tag();b.data=d.data,b.states=d.states}for(var e={data:b.data,states:b.states,actions:{},state:b.state()},f=function(a){var c=a;return function(){b.behavior(c)}},g=0;g<b.actions.length;g++){var h=b.actions[g];e.actions[h]=f(h)}return b.binding=e,b.binding},g.init=function(c){var d=this,g=a.extension.rosetta.hasDuetBindings(this);if(!g||d.lazyInit){for(;d.firstChild;)d.removeChild(d.firstChild);var h=d.model();d.dataset.dt&&c&&c.refreshUI(),""==d.rosettaID&&(e.tagsRepository++,d.rosettaID="rosetta.tag.ID."+b+"."+e.tagsRepository),d.state("default");for(var i=f.parseHTML(d.behavior("render")).body,j=0;j<i.children.length;j++){var k=i.children[j];d.appendChild(k.cloneNode(!0))}a.extension.rosetta.bindCtrlChildNodes(d,d.rosettaID),a.bind(h,d.rosettaID,!0),d.behaviors[d.state()].init&&d.behavior("init"),d.binding._state.subscribe(function(b){if(d.behaviors[d.state()].init&&d.behavior("init"),d.behaviors[d.state()].render&&d.isDirtyDOM){for(d.isDirtyDOM=!1;d.firstChild;)d.removeChild(d.firstChild);for(var c=f.parseHTML(d.behavior("render")).body,e=0;e<c.children.length;e++){var g=c.children[e];d.appendChild(g.cloneNode(!0))}a.extension.rosetta.bindCtrlChildNodes(d,d.rosettaID),a.bind(d.binding,d.rosettaID,!0)}d.behaviors[d.state()].render?d.isDirtyDOM=!0:d.isDirtyDOM=!1})}},g.rosettaID="",g.isDirtyDOM=!0,g.binding={},g.lazyInit=!1,g.typeName=b;var h=a.injectDep(d,c,e);for(var i in h)g[i]=h[i];g.createdCallback=function(){this.init()},window[b]=document.registerElement("dt-"+b,{prototype:g})},e.tags[b]()}},b.prototype.bootstrap=function(){a.preInit(function(b){var c=document.body.attributes.rosetta.value;a.rosettaApp=c,a.model=app.rootContext;for(var d in app.externalApps){var e=a.module(app.externalApps[d]).onInit;for(var f in e)e[f]()}for(var g in app.onInit)app.onInit[g]();for(var d in app.externalApps){var h=a.module(app.externalApps[d]).onLoad;for(var f in h)h[f]()}for(var g in app.onLoad)app.onLoad[g]();a.bind(app.rootContext);var i=a.extension.rosetta.getControllers();app.cacheControllers={},a.extension.rosetta.configControllers(i,app.cacheControllers)}),a.init()},a.extension.rosetta.getControllers=function(a){a||(a=document);for(var b=a.getElementsByTagName("*"),c=[],d=[],e=0;e<b.length;e++){var f=b[e];if(f.attributes.hasOwnProperty("controller")||f.attributes.hasOwnProperty("data-controller")){var g;f.attributes.hasOwnProperty("controller")?g=f.attributes.controller.value:f.attributes.hasOwnProperty("data-controller")&&(g=f.attributes["data-controller"].value);for(var h,i=!1,j=0;j<d.length&&!i;j++)i=d[j].element.contains(f),i&&(h=d[j].name);i||d.push({element:f,name:g}),c.push({name:g,container:f,parent:h})}}return c.reverse()},a.extension.rosetta.bindCtrlChildNodes=function(a,b){a||(a=document);var c=new ModelView;c.originalModel.modelName="duet.model";var d=c.getAllDuetNodes(a);for(var e in d)d[e].setAttribute("dt",b)},a.extension.rosetta.configController=function(b,c,e,f){if(e[c])e[c].binding();else{if(!f)for(var g=0;g<b.length&&!f;g++)b[g].name==c&&(f=b[g]);if(f){var h;f.parent&&(e[f.parent]||a.extension.rosetta.configController(b,f.parent,e),h=e[f.parent]);var i=app.controllers[c](h);e[c]=i,window[c]=i.model,a.bind(i.model,c,!0);for(var g=0;g<i.watchers.length;g++){var j=i.watchers[g];d(j.prop,j.callback,i)}}}},a.extension.rosetta.configControllers=function(b,c){for(var d in b){var e=b[d];a.extension.rosetta.bindCtrlChildNodes(e.container,e.name)}for(var d in b)a.extension.rosetta.configController(b,b[d].name,c,b[d])},a.extension.rosetta.hasDuetBindings=function(a){var b=!1;if((a.attributes.hasOwnProperty("dt")||a.attributes.hasOwnProperty("data-dt"))&&(b=a.attributes.hasOwnProperty("dt")||a.attributes.hasOwnProperty("data-dt")),!b)for(var c=0;c<a.attributes.length&&!b;c++){var d=a.attributes[c],e=d.name;0==d.name.indexOf("data-")&&(e=d.name.slice(5)),(0==e.indexOf("dt")||0==e.indexOf("dt")&&"dt-binding-generation"!=e)&&(b=!0)}return b}}(duet),duet.module("http",null,function(a){var b=function(a,b,c,d){var e=new XMLHttpRequest;e.open(a,b),e.send(null),e.onreadystatechange=function(){var a=4,b=200;if(e.readyState===a)if(e.status===b){if(c){var f;try{f=JSON.parse(e.responseText)}catch(g){f=e.response}c({data:f,XMLHttpRequest:e})}}else console.log("Error: "+e.status),d&&d(e)}};a.get=function(a,c,d){b("GET",a,c,d)},a.jsonp=function(a,b,c){var d="jsonp_callback_"+Math.round(1e5*Math.random());c&&(d=c),window[d]=function(a){delete window[d],document.body.removeChild(e),b(a)};var e=document.createElement("script");e.src=a+(a.indexOf("?")>=0?"&":"?")+"callback="+d,document.body.appendChild(e)}},!0),duet.module("router",["http"],function(context,http){var loadedScripts=[],inlineScripts=[],viewCount=0,viewTotal=0,scriptsCount=0,scriptsTotal=0,pendingViews={},loadedViews=[];context.view={},context.params={},context.otherwise=null,context.engineroute={"default":{name:"default",url:":controller/:action/:id?",views:function(){var a=duet.getRosettaApp(),b=context.params.controller,c=context.params.action,d=a.cacheControllers[b];return d||(d=a.controllers[b]()),d[c]()}}},context.registerRoute=function(a){return context.engineroute[a.name]=a,context},context.otherWise=function(a){return context.otherwise=a,context},context.loadPartialView=function(a,b){http.get(b,function(b){var c=document.querySelector('[partialView="'+a+'"]');c.innerHTML=b.data;for(var d=duet.extension.rosetta.getControllers(c),e=duet.getRosettaApp(),f=0;f<d.length;f++)e.cacheControllers[d[f].name]=void 0;context.loadScripts(c,a)})},context.loadScripts=function(a,b){var c=a.querySelectorAll("script"),d=[];scriptsCount=0,inlineScripts=[];for(var e=0;e<c.length;e++){var f=c[e];f.src&&loadedScripts.indexOf(f.src)==-1?(scriptsTotal++,loadedScripts.push(f.src),d.push(f.src)):inlineScripts.push(f.innerText)}if(scriptsTotal=d.length,scriptsTotal>0)for(var e=0;e<d.length;e++){var g=document.createElement("script");g.onload=function(){viewLoadComplete(b,a)},g.src=d[e],a.appendChild(g)}else viewLoadComplete(b,a)},context.init=function(){eventRoute({newURL:location.href})};var viewLoadComplete=function(viewname,htmlComponent){if(scriptsCount++,scriptsCount>=scriptsTotal){for(var i=0;i<inlineScripts.length;i++)eval(inlineScripts[i]);if(loadedScripts.push(viewname),viewCount++,viewCount>=viewTotal){var hasPendingViews=!1;for(var pView in pendingViews){hasPendingViews=!0;break}if(hasPendingViews)loadViews(pendingViews);else{for(var pageCtrls=duet.extension.rosetta.getControllers(),app=duet.getRosettaApp(),ctrlList=[],k=0;k<pageCtrls.length;k++)ctrlList.push(pageCtrls[k].name);for(var subModel in duet.subModelViews)ctrlList.indexOf(subModel)==-1&&(duet.subModelViews[subModel].unbind(),duet.subModels[subModel]=void 0,duet.subModelViews[subModel]=void 0);duet.extension.rosetta.configControllers(pageCtrls,app.cacheControllers)}}}},redirect=function(a){var b=a.newURL.slice(0,a.newURL.indexOf("#")+1);""==b&&(b=a.newURL+"#");var c=b+context.otherwise;window.location.href!=c&&window.location.assign(c)},loadViews=function(a){viewCount=0,viewTotal=0,pendingViews={};var b=[];for(var c in a){var d,e=c.split(".");d=a[c].originalPartialName?a[c].originalPartialName:c,e.length>1&&loadedViews.indexOf(e[0])==-1?(a[c].originalPartialName||(a[c].originalPartialName=c),pendingViews[e.slice(1).join(".")]=a[c]):b.push({name:c,oriName:d})}viewTotal=b.length;for(var f=0;f<b.length;f++){var g,h=b[f].name,i=b[f].oriName,c=a[h];g="string"==typeof c.template?c.template:c.template(context),context.loadPartialView(i,g)}},eventRoute=function(a){if(context.view={},context.params={},a.preventDefault&&a.preventDefault(),a.newURL.indexOf("#")!=-1){var b,c,d=a.newURL.slice(a.newURL.indexOf("#")+1).split("/");for(var e in context.engineroute){var f=[],g=context.engineroute[e],h=g.url.split("/"),i=d.length<=h.length;for(var j in h){var k=h[j];if(0==k.indexOf(":")?k.indexOf("?")==k.length-1?f.push(k.slice(1,k.length-1)):(f.push(k.slice(1)),i=i&&d.length>j):(f.push(null),i=i&&d.length>j&&k==d[j]),!i)break}i&&(b=f,c=g)}if(c){if(d.length>0)for(var l=0;d.length>l&&d[l]&&null!=d[l];)b.length>l&&null!=b[l]&&(context.params[b[l]]=d[l]),l++;var m;m="object"==typeof c.views?c.views:c.views(context),loadedViews=[],loadViews(m)}else redirect(a)}else redirect(a)};window.addEventListener("hashchange",eventRoute,!1)},!0);
//# sourceMappingURL=../sourceMap.map